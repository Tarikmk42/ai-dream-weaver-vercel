<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Dream Weaver - –ò–≥—Ä–∞ –≤ –º–∏—Ä–µ —Å–Ω–æ–≤</title>
    
    <!-- Meta —Ç–µ–≥–∏ –¥–ª—è SEO –∏ —Å–æ—Ü—Å–µ—Ç–µ–π -->
    <meta name="description" content="–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∏–≥—Ä–∞ —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –º–∏—Ä–æ–≤ –Ω–µ–π—Ä–æ—Å–µ—Ç—è–º–∏. –ò—Å—Å–ª–µ–¥—É–π—Ç–µ –º–∏—Ä —Å–Ω–æ–≤ —Å –ø–æ–º–æ—â—å—é AI!">
    <meta property="og:title" content="AI Dream Weaver">
    <meta property="og:description" content="–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∏–≥—Ä–∞ —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –º–∏—Ä–æ–≤ –Ω–µ–π—Ä–æ—Å–µ—Ç—è–º–∏">
    <meta property="og:image" content="https://images.unsplash.com/photo-1518709268805-4e9042af2176?auto=format&fit=crop&w=1200&q=80">
    <meta property="og:url" content="https://ai-dream-weaver.vercel.app">
    <meta property="og:type" content="website">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåå</text></svg>">
    
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        /* ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –°–¢–ò–õ–ò ========== */
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            margin: 0;
            padding: 0;
        }

        :root {
            --primary-color: #4a6fff;
            --secondary-color: #8a2fff;
            --accent-color: #00ff88;
            --danger-color: #ff5555;
            --warning-color: #ffaa00;
            --background-dark: #0a0a1a;
            --background-medium: #1a1a2e;
            --background-light: rgba(255, 255, 255, 0.05);
            --text-color: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
        }

        body {
            margin: 0;
            padding: 0;
            background: var(--background-dark);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            touch-action: manipulation;
            height: 100vh;
            width: 100vw;
            user-select: none;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(74, 111, 255, 0.15) 0%, transparent 20%),
                radial-gradient(circle at 80% 20%, rgba(138, 47, 255, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 40% 80%, rgba(0, 255, 136, 0.1) 0%, transparent 20%);
        }

        /* ========== –ó–ê–ì–†–£–ó–ß–ò–ö ========== */
        #loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--background-dark);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }

        .loader-spinner {
            width: 80px;
            height: 80px;
            border: 6px solid rgba(74, 111, 255, 0.2);
            border-top: 6px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loader-text {
            color: var(--secondary-color);
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin-top: 20px;
        }

        /* ========== –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† ========== */
        .main-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            gap: 10px;
            z-index: 1;
        }

        /* ========== –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï ========== */
        .image-container {
            flex: 2;
            min-height: 40vh;
            background: var(--background-medium);
            border: 2px solid var(--primary-color);
            border-radius: 20px;
            margin: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
        }

        .image-container:hover {
            border-color: var(--secondary-color);
            box-shadow: 0 15px 40px rgba(74, 111, 255, 0.2);
        }

        #game-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 15px;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .image-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: var(--text-secondary);
            font-size: 16px;
        }

        .image-placeholder::before {
            content: "üé®";
            font-size: 48px;
            display: block;
            margin-bottom: 10px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* ========== –ö–û–ù–¢–ï–ô–ù–ï–† –ò–°–¢–û–†–ò–ò ========== */
        .story-container {
            flex: 1;
            max-height: 35vh;
            min-height: 25vh;
            background: rgba(0, 0, 30, 0.92);
            backdrop-filter: blur(20px) saturate(180%);
            border: 2px solid var(--primary-color);
            border-radius: 20px;
            padding: 20px;
            margin: 0 15px;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
        }

        .story-container:hover {
            border-color: var(--secondary-color);
        }

        #story-text {
            font-size: 16px;
            line-height: 1.6;
            margin: 0;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
        }

        .story-line {
            margin-bottom: 15px;
            padding: 12px;
            background: var(--background-light);
            border-radius: 10px;
            border-left: 4px solid var(--primary-color);
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            color: var(--accent-color);
            border-left-color: var(--accent-color);
        }

        .ai-message {
            color: var(--text-color);
        }

        .quest-update {
            color: var(--warning-color);
            border-left-color: var(--warning-color);
            background: rgba(255, 170, 0, 0.1);
        }

        /* ========== –ö–û–ù–¢–ï–ô–ù–ï–† –í–í–û–î–ê ========== */
        .input-container {
            background: rgba(0, 0, 20, 0.95);
            backdrop-filter: blur(25px) saturate(200%);
            border: 2px solid var(--secondary-color);
            border-radius: 20px;
            padding: 15px;
            margin: 15px;
            display: flex;
            gap: 12px;
            box-shadow: 0 -5px 25px rgba(0, 0, 0, 0.5);
        }

        #user-input {
            flex: 1;
            padding: 18px 20px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.08);
            color: var(--text-color);
            border: 2px solid var(--primary-color);
            border-radius: 15px;
            outline: none;
            min-height: 56px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        #user-input:focus {
            background: rgba(255, 255, 255, 0.12);
            border-color: var(--secondary-color);
            box-shadow: 0 0 20px rgba(138, 47, 255, 0.3);
        }

        #user-input::placeholder {
            color: var(--text-secondary);
        }

        #action-btn {
            padding: 0 30px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            min-width: 90px;
            transition: all 0.3s ease;
            font-family: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #action-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(138, 47, 255, 0.4);
        }

        #action-btn:active:not(:disabled) {
            transform: translateY(0);
        }

        #action-btn:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* ========== –ë–û–ö–û–í–´–ï –ü–ê–ù–ï–õ–ò ========== */
        .side-panel {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            width: 320px;
            max-width: 85vw;
            background: rgba(0, 0, 30, 0.98);
            backdrop-filter: blur(25px) saturate(200%);
            border: 2px solid var(--primary-color);
            border-radius: 20px;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
            display: none;
            z-index: 100;
        }

        #inventory-panel {
            left: 15px;
            max-height: 80vh;
        }

        #quest-panel {
            right: 15px;
            max-height: 80vh;
        }

        .side-panel h3 {
            color: var(--secondary-color);
            margin-bottom: 20px;
            font-size: 22px;
            text-align: center;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }

        /* ========== –ö–ù–û–ü–ö–ò –ü–ê–ù–ï–õ–ï–ô ========== */
        .toggle-panel-btn {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 120px;
            background: linear-gradient(135deg, rgba(74, 111, 255, 0.9), rgba(138, 47, 255, 0.9));
            border: none;
            border-radius: 0 15px 15px 0;
            color: white;
            font-size: 28px;
            cursor: pointer;
            z-index: 90;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .toggle-panel-btn:hover {
            width: 60px;
            box-shadow: 0 10px 25px rgba(74, 111, 255, 0.4);
        }

        #toggle-inventory {
            left: 0;
            border-radius: 0 15px 15px 0;
        }

        #toggle-quests {
            right: 0;
            border-radius: 15px 0 0 15px;
        }

        /* ========== –ò–ù–í–ï–ù–¢–ê–†–¨ ========== */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .inventory-item {
            background: var(--background-light);
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .inventory-item:hover {
            transform: translateY(-3px);
            border-color: var(--secondary-color);
            box-shadow: 0 5px 15px rgba(138, 47, 255, 0.2);
        }

        .inventory-item::before {
            content: attr(data-emoji);
            font-size: 24px;
            display: block;
            margin-bottom: 8px;
        }

        /* ========== HP –ë–ê–† ========== */
        .stats-container {
            margin: 20px 0;
            padding: 15px;
            background: rgba(74, 111, 255, 0.1);
            border-radius: 15px;
        }

        .hp-bar-container {
            margin-bottom: 15px;
        }

        .hp-label {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            margin-bottom: 5px;
            color: var(--text-secondary);
        }

        .hp-bar {
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .hp-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), #00cc66);
            border-radius: 10px;
            width: 100%;
            transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
        }

        .hp-fill.danger {
            background: linear-gradient(90deg, var(--danger-color), #cc0000);
            animation: pulse 1.5s infinite;
        }

        .hp-text {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        /* ========== –ö–í–ï–°–¢–´ ========== */
        .quest-list {
            margin: 15px 0;
        }

        .quest-item {
            background: var(--background-light);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid var(--warning-color);
            transition: all 0.3s ease;
        }

        .quest-item.completed {
            border-left-color: var(--accent-color);
            background: rgba(0, 255, 136, 0.1);
        }

        .quest-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .quest-icon {
            font-size: 20px;
        }

        .quest-title {
            font-weight: bold;
            color: var(--text-color);
        }

        .quest-description {
            font-size: 14px;
            color: var(--text-secondary);
            margin-left: 30px;
        }

        /* ========== –ö–ù–û–ü–ö–ò –í–´–ë–û–†–ê ========== */
        .choice-container {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .choice-btn {
            display: block;
            width: 100%;
            padding: 12px 15px;
            margin: 8px 0;
            background: linear-gradient(135deg, var(--primary-color), #2244cc);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s ease;
        }

        .choice-btn:hover {
            transform: translateX(5px);
            background: linear-gradient(135deg, var(--secondary-color), #3355dd);
            box-shadow: 0 5px 15px rgba(51, 102, 255, 0.3);
        }

        /* ========== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ========== */
        #notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, rgba(0, 0, 30, 0.95), rgba(26, 26, 46, 0.95));
            backdrop-filter: blur(20px);
            border: 2px solid var(--primary-color);
            border-radius: 15px;
            padding: 15px 25px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            display: none;
            pointer-events: none;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            text-align: center;
            max-width: 90%;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* ========== –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ ========== */
        @media (max-height: 700px) {
            .image-container {
                min-height: 35vh;
                margin: 10px;
            }
            
            .story-container {
                max-height: 30vh;
                padding: 15px;
                margin: 0 10px;
            }
            
            .input-container {
                padding: 12px;
                margin: 10px;
            }
            
            #user-input {
                padding: 15px 18px;
                font-size: 15px;
                min-height: 50px;
            }
            
            #action-btn {
                padding: 0 25px;
                font-size: 16px;
                min-width: 80px;
            }
            
            .side-panel {
                width: 280px;
                padding: 15px;
            }
        }

        @media (max-height: 600px) {
            .image-container {
                min-height: 30vh;
            }
            
            .story-container {
                max-height: 25vh;
            }
            
            #story-text {
                font-size: 14px;
            }
        }

        @media (max-width: 768px) {
            .side-panel {
                width: 90vw;
            }
            
            .inventory-grid {
                grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            }
        }

        /* ========== –°–ö–†–û–õ–õ–ë–ê–† ========== */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--secondary-color), #aa4fff);
        }

        /* ========== –ê–ù–ò–ú–ê–¶–ò–ò ========== */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
    </style>
</head>
<body>
    <!-- –ó–∞–≥—Ä—É–∑—á–∏–∫ -->
    <div id="loader">
        <div class="loader-spinner"></div>
        <div class="loader-text">üåå –ü—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ –º–∏—Ä–∞ —Å–Ω–æ–≤...</div>
        <div style="margin-top: 30px; color: rgba(255,255,255,0.6); font-size: 14px; max-width: 300px; text-align: center;">
            –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="main-container">
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
        <div class="image-container">
            <img id="game-image" alt="–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∏—Ä–∞ —Å–Ω–æ–≤">
            <div class="image-placeholder">
                –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å<br>
                <small style="font-size: 12px; opacity: 0.7;">–ü–æ—Å–ª–µ –≤–∞—à–µ–≥–æ –ø–µ—Ä–≤–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è</small>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏ -->
        <div class="story-container">
            <div id="story-text">
                <div class="story-line">
                    <strong style="color: var(--secondary-color);">üåå AI DREAM WEAVER</strong><br><br>
                    –í—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ –≥–ª–∞–∑–∞ –≤ –Ω–µ–∑–Ω–∞–∫–æ–º–æ–º –º–µ—Å—Ç–µ. –í–æ–∑–¥—É—Ö –Ω–∞–ø–æ–ª–Ω–µ–Ω –º–∞–≥–∏–µ–π, –∞ –≤–æ–∫—Ä—É–≥ ‚Äî –º–∏—Ä, —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∏–∑ —Å–Ω–æ–≤.<br><br>
                    –í—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ, —á—Ç–æ –º–æ–∂–µ—Ç–µ –≤–ª–∏—è—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å —Å–∏–ª–æ–π –º—ã—Å–ª–∏... –ß—Ç–æ –≤—ã —Å–¥–µ–ª–∞–µ—Ç–µ –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å?
                </div>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–≤–æ–¥–∞ -->
        <div class="input-container">
            <input type="text" id="user-input" placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à–µ –¥–µ–π—Å—Ç–≤–∏–µ... (–Ω–∞–ø—Ä–∏–º–µ—Ä: '–æ—Å–º–æ—Ç—Ä—é—Å—å –≤–æ–∫—Ä—É–≥')" autocomplete="off" autofocus>
            <button id="action-btn">‚ñ∂Ô∏è</button>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ –±–æ–∫–æ–≤—ã—Ö –ø–∞–Ω–µ–ª–µ–π -->
    <button class="toggle-panel-btn" id="toggle-inventory" title="–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å">üéí</button>
    <button class="toggle-panel-btn" id="toggle-quests" title="–ö–≤–µ—Å—Ç—ã">üìú</button>

    <!-- –ü–∞–Ω–µ–ª—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è -->
    <div id="inventory-panel" class="side-panel">
        <h3>üéí –ò–ù–í–ï–ù–¢–ê–†–¨</h3>
        <div class="inventory-grid" id="inventory-list">
            <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        
        <div class="stats-container">
            <div class="hp-bar-container">
                <div class="hp-label">
                    <span>‚ù§Ô∏è –ó–î–û–†–û–í–¨–ï</span>
                    <span id="hp-value">100/100</span>
                </div>
                <div class="hp-bar">
                    <div id="player-hp-fill" class="hp-fill" style="width: 100%">
                        <div class="hp-text">100%</div>
                    </div>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px;">
                <div style="text-align: center; padding: 10px; background: var(--background-light); border-radius: 8px;">
                    <div style="font-size: 12px; color: var(--text-secondary);">‚öîÔ∏è –£–†–û–í–ï–ù–¨</div>
                    <div id="player-level" style="font-weight: bold; font-size: 18px;">1</div>
                </div>
                <div style="text-align: center; padding: 10px; background: var(--background-light); border-radius: 8px;">
                    <div style="font-size: 12px; color: var(--text-secondary);">üó°Ô∏è –ê–¢–ê–ö–ê</div>
                    <div id="player-attack" style="font-weight: bold; font-size: 18px;">10</div>
                </div>
                <div style="text-align: center; padding: 10px; background: var(--background-light); border-radius: 8px;">
                    <div style="font-size: 12px; color: var(--text-secondary);">üõ°Ô∏è –ó–ê–©–ò–¢–ê</div>
                    <div id="player-defense" style="font-weight: bold; font-size: 18px;">5</div>
                </div>
                <div style="text-align: center; padding: 10px; background: var(--background-light); border-radius: 8px;">
                    <div style="font-size: 12px; color: var(--text-secondary);">‚≠ê –û–ü–´–¢</div>
                    <div id="player-exp" style="font-weight: bold; font-size: 18px;">0/100</div>
                </div>
            </div>
        </div>
        
        <div style="margin-top: 15px; padding: 12px; background: rgba(138, 47, 255, 0.1); border-radius: 10px; font-size: 13px; color: var(--text-secondary); text-align: center;">
            üí° <strong>–°–æ–≤–µ—Ç:</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –≤ –¥–µ–π—Å—Ç–≤–∏—è—Ö!
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –∫–≤–µ—Å—Ç–æ–≤ -->
    <div id="quest-panel" class="side-panel">
        <h3>üìú –ö–í–ï–°–¢–´</h3>
        
        <div class="quest-list">
            <div class="quest-item">
                <div class="quest-header">
                    <span class="quest-icon">üåü</span>
                    <span class="quest-title">–ü—Ä–æ–±—É–¥–∏—Ç—å –•—Ä–∞–Ω–∏—Ç–µ–ª—è –°–Ω–æ–≤</span>
                </div>
                <div class="quest-description" id="quest-progress">–ü—Ä–æ–≥—Ä–µ—Å—Å: 0%</div>
            </div>
            
            <div id="quest-objectives">
                <!-- –¶–µ–ª–∏ –∫–≤–µ—Å—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            
            <div id="side-quests" style="margin-top: 20px;">
                <!-- –ü–æ–±–æ—á–Ω—ã–µ –∫–≤–µ—Å—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
        
        <div style="margin-top: 20px; padding: 12px; background: rgba(0, 255, 136, 0.1); border-radius: 10px; font-size: 13px; color: var(--text-secondary);">
            üíé <strong>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</strong><br>
            <div style="margin-top: 8px;">
                <div>üìç –û—Ç–∫—Ä—ã—Ç–æ –ª–æ–∫–∞—Ü–∏–π: <span id="locations-count">1</span></div>
                <div>üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏–π: <span id="achievements-count">0</span></div>
                <div>üí∞ –ó–æ–ª–æ—Ç–∞: <span id="gold-count">50</span></div>
            </div>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div id="notification"></div>

    <!-- ========== JAVASCRIPT ========== -->
    <script>
        // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ==========
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—ã
        const isLocalhost = window.location.hostname === 'localhost' || 
                            window.location.hostname === '127.0.0.1';
        
        const API_BASE = isLocalhost ? 'http://localhost:3000' : '';
        
        const SD_API = `${API_BASE}/api/sd-proxy`;
        const LLM_API = `${API_BASE}/api/llm-proxy`;
        const HEALTH_API = `${API_BASE}/api/health`;
        
        console.log('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:', {
            isLocalhost,
            API_BASE,
            SD_API,
            LLM_API,
            location: window.location.href
        });

        // ========== –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´ ==========
        const gameState = {
            history: [],
            inventory: [
                { id: 1, name: '–ó–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è', emoji: 'üß™', description: '–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 30 HP' },
                { id: 2, name: '–ú–∞–≥–∏—á–µ—Å–∫–∏–π —Å–≤–∏—Ç–æ–∫', emoji: 'üìú', description: '–û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç–∞–π–Ω—ã–µ –ø—É—Ç–∏' },
                { id: 3, name: '–ö–ª—é—á –æ—Ç —Ö—Ä–∞–º–∞', emoji: 'üîë', description: '–û—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥—Ä–µ–≤–Ω–∏–µ –¥–≤–µ—Ä–∏' },
                { id: 4, name: '–ö–∞—Ä—Ç–∞ —Å–Ω–æ–≤', emoji: 'üó∫Ô∏è', description: '–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∫—Ä—ã—Ç—ã–µ –ª–æ–∫–∞—Ü–∏–∏' },
                { id: 5, name: '–ú–∞–≥–∏—á–µ—Å–∫–∏–π –∫—Ä–∏—Å—Ç–∞–ª–ª', emoji: 'üíé', description: '–ò—Å—Ç–æ—á–Ω–∏–∫ –º–∞–≥–∏—á–µ—Å–∫–æ–π —Å–∏–ª—ã' }
            ],
            player: {
                name: '–ü—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫',
                hp: 100,
                maxHp: 100,
                attack: 10,
                defense: 5,
                level: 1,
                exp: 0,
                gold: 50,
                mana: 50,
                maxMana: 50
            },
            quests: {
                main: {
                    title: '–ü—Ä–æ–±—É–¥–∏—Ç—å –•—Ä–∞–Ω–∏—Ç–µ–ª—è –°–Ω–æ–≤',
                    description: '–ù–∞–π–¥–∏—Ç–µ —Ç—Ä–∏ –¥—Ä–µ–≤–Ω–∏—Ö –∫—Ä–∏—Å—Ç–∞–ª–ª–∞ –∏ –ø—Ä–æ–≤–µ–¥–∏—Ç–µ —Ä–∏—Ç—É–∞–ª',
                    progress: 0,
                    objectives: [
                        { id: 1, text: '–ù–∞–π—Ç–∏ –ö—Ä–∞—Å–Ω—ã–π –ö—Ä–∏—Å—Ç–∞–ª–ª –≤ –û–≥–Ω–µ–Ω–Ω—ã—Ö –ü–µ—â–µ—Ä–∞—Ö', done: false, keyword: '–∫—Ä–∞—Å–Ω—ã–π –∫—Ä–∏—Å—Ç–∞–ª–ª' },
                        { id: 2, text: '–ù–∞–π—Ç–∏ –°–∏–Ω–∏–π –ö—Ä–∏—Å—Ç–∞–ª–ª –≤ –ó–∞—Ç–æ–ø–ª–µ–Ω–Ω–æ–º –•—Ä–∞–º–µ', done: false, keyword: '—Å–∏–Ω–∏–π –∫—Ä–∏—Å—Ç–∞–ª–ª' },
                        { id: 3, text: '–ù–∞–π—Ç–∏ –ó–µ–ª—ë–Ω—ã–π –ö—Ä–∏—Å—Ç–∞–ª–ª –≤ –õ–µ—Å—É –î—É—Ö–æ–≤', done: false, keyword: '–∑–µ–ª–µ–Ω—ã–π –∫—Ä–∏—Å—Ç–∞–ª–ª' },
                        { id: 4, text: '–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–∏—Ç—É–∞–ª –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è', done: false, keyword: '—Ä–∏—Ç—É–∞–ª' }
                    ]
                },
                side: [
                    { id: 101, title: '–ü–æ–º–æ—á—å –ø–æ—Ç–µ—Ä—è–Ω–Ω–æ–º—É –¥—É—Ö—É', description: '–ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ–ø–∞–≤—à–∏–π –∞–º—É–ª–µ—Ç –¥—É—Ö–∞', done: false },
                    { id: 102, title: '–°–æ–±—Ä–∞—Ç—å –º–∞–≥–∏—á–µ—Å–∫–∏–µ –≥—Ä–∏–±—ã', description: '–°–æ–±–µ—Ä–∏—Ç–µ 5 —Ä–µ–¥–∫–∏—Ö –≥—Ä–∏–±–æ–≤', done: false }
                ]
            },
            discoveredLocations: [
                { id: 1, name: '–õ–µ—Å –°–Ω–æ–≤', emoji: 'üå≥', discovered: true }
            ],
            achievements: []
        };

        // ========== –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
        let isGenerating = false;
        let currentAction = null;

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('AI Dream Weaver –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è...');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
            if (window.Telegram?.WebApp) {
                try {
                    Telegram.WebApp.ready();
                    Telegram.WebApp.expand();
                    Telegram.WebApp.enableClosingConfirmation();
                    
                    const user = Telegram.WebApp.initDataUnsafe?.user;
                    if (user) {
                        gameState.player.name = user.first_name || '–ü—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫';
                        addStoryLine(`‚ú® –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <strong>${gameState.player.name}</strong>!`, 'ai-message');
                    }
                    
                    console.log('Telegram Web App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                } catch (error) {
                    console.log('Telegram Web App –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω:', error);
                }
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            loadGame();

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
            setupEventListeners();

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            updateUI();

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ API
            await testAPI();

            // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑—á–∏–∫
            setTimeout(() => {
                const loader = document.getElementById('loader');
                loader.style.opacity = '0';
                setTimeout(() => {
                    loader.style.display = 'none';
                    showNotification('üåå –ú–∏—Ä —Å–Ω–æ–≤ –≥–æ—Ç–æ–≤! –ù–∞—á–Ω–∏—Ç–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ...', 3000);
                    
                    // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                    const input = document.getElementById('user-input');
                    if (input) input.focus();
                }, 500);
            }, 1500);
        });

        // ========== –ü–†–û–í–ï–†–ö–ê API ==========
        async function testAPI() {
            try {
                console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API...');
                
                const response = await fetch(HEALTH_API, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' },
                    signal: AbortSignal.timeout(5000)
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('API —Å—Ç–∞—Ç—É—Å:', data);
                    addStoryLine('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –Ω–µ–π—Ä–æ—Å–µ—Ç—è–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'ai-message');
                    return true;
                }
                
                throw new Error(`API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç: ${response.status}`);
                
            } catch (error) {
                console.warn('–ü—Ä–æ–≤–µ—Ä–∫–∞ API –Ω–µ —É–¥–∞–ª–∞—Å—å:', error);
                addStoryLine('‚ö†Ô∏è –ù–µ–π—Ä–æ—Å–µ—Ç–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞.', 'quest-update');
                return false;
            }
        }

        // ========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ==========
        function setupEventListeners() {
            // –ö–Ω–æ–ø–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
            const actionBtn = document.getElementById('action-btn');
            const userInput = document.getElementById('user-input');
            
            if (actionBtn) {
                actionBtn.addEventListener('click', handleUserAction);
            }
            
            if (userInput) {
                userInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        handleUserAction();
                    }
                });
                
                userInput.addEventListener('input', () => {
                    if (userInput.value.length > 200) {
                        userInput.value = userInput.value.substring(0, 200);
                        showNotification('‚ö†Ô∏è –°–æ–æ–±—â–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ 200 —Å–∏–º–≤–æ–ª–∞–º–∏');
                    }
                });
            }

            // –ö–Ω–æ–ø–∫–∏ –ø–∞–Ω–µ–ª–µ–π
            document.getElementById('toggle-inventory')?.addEventListener('click', () => togglePanel('inventory-panel'));
            document.getElementById('toggle-quests')?.addEventListener('click', () => togglePanel('quest-panel'));

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–µ–π –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
            document.addEventListener('click', (e) => {
                const panels = ['inventory-panel', 'quest-panel'];
                const toggles = ['toggle-inventory', 'toggle-quests'];
                
                const clickedPanel = panels.some(id => {
                    const panel = document.getElementById(id);
                    return panel?.contains(e.target);
                });
                
                const clickedToggle = toggles.some(id => {
                    const toggle = document.getElementById(id);
                    return toggle?.contains(e.target);
                });
                
                if (!clickedPanel && !clickedToggle) {
                    panels.forEach(id => {
                        const panel = document.getElementById(id);
                        if (panel) panel.style.display = 'none';
                    });
                }
            });

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
            window.addEventListener('beforeunload', saveGame);
            window.addEventListener('pagehide', saveGame);

            // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(saveGame, 30000);

            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
            window.addEventListener('resize', () => {
                const image = document.getElementById('game-image');
                if (image && image.complete) {
                    image.style.maxWidth = '100%';
                    image.style.maxHeight = '100%';
                }
            });
        }

        // ========== –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê ==========
        async function handleUserAction() {
            if (isGenerating) {
                showNotification('‚è≥ –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...');
                return;
            }

            const input = document.getElementById('user-input');
            const btn = document.getElementById('action-btn');
            const text = input?.value.trim();

            if (!text) {
                showNotification('‚úèÔ∏è –í–≤–µ–¥–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ!');
                input?.focus();
                return;
            }

            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            isGenerating = true;
            currentAction = text;
            if (btn) btn.disabled = true;

            // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ–π—Å—Ç–≤–∏–µ –∏–≥—Ä–æ–∫–∞
            addStoryLine(`<strong>${gameState.player.name}:</strong> ${text}`, 'user-message');

            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–≤–µ—Å—Ç—ã
                checkQuestProgress(text);

                // –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç AI
                const response = await askAI(text);
                addStoryLine(response, 'ai-message');

                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                await generateImage(text);

                // –°–ª—É—á–∞–π–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
                triggerRandomEvent();

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ–π—Å—Ç–≤–∏—è:', error);
                
                // Fallback –æ—Ç–≤–µ—Ç
                const fallbackResponses = [
                    `–í—ã "${text.toLowerCase()}" –≤ –º–∏—Ä–µ —Å–Ω–æ–≤. –ß—Ç–æ –±—É–¥–µ—Ç–µ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ?`,
                    `"${text}" - –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤—ã–±–æ—Ä. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤–∞—à–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ.`,
                    `–ú–∏—Ä —Å–Ω–æ–≤ –æ—Ç–∫–ª–∏–∫–∞–µ—Ç—Å—è –Ω–∞ –≤–∞—à–µ –¥–µ–π—Å—Ç–≤–∏–µ. –ü–µ—Ä–µ–¥ –≤–∞–º–∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.`
                ];
                
                const fallback = fallbackResponses[Math.floor(Math.random() * fallbackResponses.length)];
                addStoryLine(fallback, 'ai-message');
                
                showNotification('‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞');
                
            } finally {
                // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                isGenerating = false;
                currentAction = null;
                if (btn) btn.disabled = false;
                if (input) {
                    input.value = '';
                    input.focus();
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–≥—Ä—É –∏ –æ–±–Ω–æ–≤–ª—è–µ–º UI
                saveGame();
                updateUI();
            }
        }

        // ========== AI –§–£–ù–ö–¶–ò–ò ==========
        async function askAI(prompt) {
            try {
                const response = await fetch(LLM_API, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'local-model',
                        messages: [
                            {
                                role: 'system',
                                content: `–¢—ã –º–∞—Å—Ç–µ—Ä –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –≤ —Ñ—ç–Ω—Ç–µ–∑–∏-–º–∏—Ä–µ —Å–Ω–æ–≤. –ò–≥—Ä–æ–∫: ${gameState.player.name}. 
                                –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è), –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω–æ. –ü–æ—Å–ª–µ –æ–ø–∏—Å–∞–Ω–∏—è –ø—Ä–µ–¥–ª–æ–∂–∏ 2-3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –¥–µ–π—Å—Ç–≤–∏–π.
                                –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ –¥–ª—è —É–∫—Ä–∞—à–µ–Ω–∏—è.`
                            },
                            {
                                role: 'user',
                                content: `–î–µ–π—Å—Ç–≤–∏–µ: "${prompt}". –û–ø–∏—à–∏ —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –º–∏—Ä–µ —Å–Ω–æ–≤.`
                            }
                        ],
                        temperature: 0.8,
                        max_tokens: 300
                    }),
                    signal: AbortSignal.timeout(30000)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`AI API error: ${response.status} - ${errorText}`);
                }

                const data = await response.json();
                return data.choices?.[0]?.message?.content || '–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç –Ω–µ–π—Ä–æ—Å–µ—Ç–∏.';

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ AI:', error);
                throw error;
            }
        }

        async function generateImage(prompt) {
            if (!prompt) return;
            
            showNotification('üé® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...');
            
            try {
                const response = await fetch(SD_API, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        prompt: `${prompt}, fantasy art, dream world, magical, detailed, cinematic lighting`,
                        negative_prompt: "blurry, ugly, text, watermark, signature, deformed",
                        steps: 20,
                        width: 512,
                        height: 384,
                        cfg_scale: 7
                    }),
                    signal: AbortSignal.timeout(60000)
                });

                if (!response.ok) {
                    throw new Error(`Image API error: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.images && data.images[0]) {
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    const imgElement = document.getElementById('game-image');
                    const placeholder = document.querySelector('.image-placeholder');
                    
                    imgElement.src = `data:image/png;base64,${data.images[0]}`;
                    imgElement.onload = () => {
                        imgElement.style.opacity = '1';
                        if (placeholder) placeholder.style.display = 'none';
                        showNotification('‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ!', 2000);
                    };
                    
                    imgElement.onerror = () => {
                        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
                        showNotification('‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
                    };
                } else {
                    throw new Error('–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –æ—Ç–≤–µ—Ç–µ');
                }

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', error);
                showNotification('‚ö†Ô∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ');
                
                // Fallback –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                createFallbackImage(prompt);
            }
        }

        function createFallbackImage(prompt) {
            const canvas = document.createElement('canvas');
            canvas.width = 512;
            canvas.height = 384;
            const ctx = canvas.getContext('2d');
            
            // –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#0a0a1a');
            gradient.addColorStop(0.5, '#1a1a2e');
            gradient.addColorStop(1, '#16213e');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –¢–µ–∫—Å—Ç
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.font = 'bold 30px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('AI Dream Weaver', canvas.width / 2, canvas.height / 2 - 30);
            
            ctx.fillStyle = 'rgba(138, 47, 255, 0.3)';
            ctx.font = '18px Arial';
            ctx.fillText(prompt.substring(0, 40) + '...', canvas.width / 2, canvas.height / 2 + 20);
            
            // –ó–≤–µ–∑–¥—ã
            for (let i = 0; i < 50; i++) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                const radius = Math.random() * 2;
                const alpha = Math.random() * 0.5 + 0.3;
                
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
                ctx.fill();
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const imgElement = document.getElementById('game-image');
            const placeholder = document.querySelector('.image-placeholder');
            
            imgElement.src = canvas.toDataURL();
            imgElement.onload = () => {
                imgElement.style.opacity = '0.7';
                if (placeholder) placeholder.style.display = 'none';
            };
        }

        // ========== –°–ò–°–¢–ï–ú–ê –ö–í–ï–°–¢–û–í ==========
        function checkQuestProgress(actionText) {
            const lowerText = actionText.toLowerCase();
            let updated = false;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–≤–µ—Å—Ç—ã
            gameState.quests.main.objectives.forEach(obj => {
                if (!obj.done && lowerText.includes(obj.keyword)) {
                    obj.done = true;
                    updated = true;
                    
                    // –ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ü–µ–ª–∏
                    gameState.player.exp += 25;
                    gameState.player.gold += 50;
                    
                    const rewardItems = [
                        '–ú–∞–≥–∏—á–µ—Å–∫–∏–π –∞–º—É–ª–µ—Ç',
                        '–°–≤–∏—Ç–æ–∫ –∑–Ω–∞–Ω–∏–π',
                        '–≠–ª–∏–∫—Å–∏—Ä —Å–∏–ª—ã',
                        '–î—Ä–µ–≤–Ω–∏–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç'
                    ];
                    
                    const randomItem = rewardItems[Math.floor(Math.random() * rewardItems.length)];
                    gameState.inventory.push({
                        id: Date.now(),
                        name: randomItem,
                        emoji: 'üéÅ',
                        description: `–ù–∞–≥—Ä–∞–¥–∞ –∑–∞ "${obj.text}"`
                    });
                    
                    addStoryLine(`‚úÖ <strong>–¶–µ–ª—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞!</strong> ${obj.text}<br>üéÅ –ü–æ–ª—É—á–µ–Ω–æ: 25 –æ–ø—ã—Ç–∞, 50 –∑–æ–ª–æ—Ç–∞, ${randomItem}`, 'quest-update');
                    showNotification(`üéâ –í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${obj.text}`);
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            if (updated) {
                const completed = gameState.quests.main.objectives.filter(o => o.done).length;
                const total = gameState.quests.main.objectives.length;
                gameState.quests.main.progress = Math.round((completed / total) * 100);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ–≥–æ –∫–≤–µ—Å—Ç–∞
                if (completed === total) {
                    addStoryLine(`<div style="text-align: center; padding: 20px; background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,140,0,0.2)); border-radius: 15px; margin: 15px 0;">
                        <div style="font-size: 24px;">üåü üåü üåü</div>
                        <div style="font-size: 20px; font-weight: bold; color: #FFD700;">–ü–û–ë–ï–î–ê!</div>
                        <div>–•—Ä–∞–Ω–∏—Ç–µ–ª—å –°–Ω–æ–≤ –ø—Ä–æ–±—É–∂–¥–µ–Ω! –ú–∏—Ä —Å–Ω–æ–≤ —Å–ø–∞—Å–µ–Ω!</div>
                        <div style="margin-top: 10px; font-size: 14px; opacity: 0.8;">–í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ –≥–ª–∞–≤–Ω—ã–π –∫–≤–µ—Å—Ç!</div>
                    </div>`, 'quest-update');
                    
                    showNotification('üéä –ü–û–ë–ï–î–ê! –ì–ª–∞–≤–Ω—ã–π –∫–≤–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω!', 5000);
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–±–æ—á–Ω—ã–µ –∫–≤–µ—Å—Ç—ã
            gameState.quests.side.forEach(quest => {
                if (!quest.done && Math.random() < 0.1) {
                    quest.done = true;
                    gameState.player.exp += 15;
                    gameState.player.gold += 25;
                    
                    addStoryLine(`üìã <strong>–ü–æ–±–æ—á–Ω—ã–π –∫–≤–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω:</strong> ${quest.title}<br>üéÅ –ü–æ–ª—É—á–µ–Ω–æ: 15 –æ–ø—ã—Ç–∞, 25 –∑–æ–ª–æ—Ç–∞`, 'quest-update');
                }
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–µ –ª–æ–∫–∞—Ü–∏–∏
            const locationKeywords = {
                '–ª–µ—Å': { name: '–¢–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –õ–µ—Å', emoji: 'üå≥' },
                '–ø–µ—â–µ—Ä–∞': { name: '–¢–µ–º–Ω—ã–µ –ü–µ—â–µ—Ä—ã', emoji: 'üï≥Ô∏è' },
                '—Ö—Ä–∞–º': { name: '–î—Ä–µ–≤–Ω–∏–π –•—Ä–∞–º', emoji: 'üõï' },
                '–≥–æ—Ä–æ–¥': { name: '–ó–∞–±—Ä–æ—à–µ–Ω–Ω—ã–π –ì–æ—Ä–æ–¥', emoji: 'üèöÔ∏è' },
                '–æ–∑–µ—Ä–æ': { name: '–û–∑–µ—Ä–æ –û—Ç—Ä–∞–∂–µ–Ω–∏–π', emoji: 'üåä' },
                '–≥–æ—Ä–∞': { name: '–ì–æ—Ä–∞ –í–µ—á–Ω–æ—Å—Ç–∏', emoji: '‚õ∞Ô∏è' },
                '–±–∞—à–Ω—è': { name: '–ó–∞–ø—Ä–µ—Ç–Ω–∞—è –ë–∞—à–Ω—è', emoji: 'üè∞' },
                '—Å–∞–¥': { name: '–ú–∞–≥–∏—á–µ—Å–∫–∏–π –°–∞–¥', emoji: 'üå∫' }
            };
            
            Object.entries(locationKeywords).forEach(([keyword, location]) => {
                if (lowerText.includes(keyword)) {
                    const exists = gameState.discoveredLocations.find(l => l.name === location.name);
                    if (!exists) {
                        gameState.discoveredLocations.push({
                            id: gameState.discoveredLocations.length + 1,
                            name: location.name,
                            emoji: location.emoji,
                            discovered: true
                        });
                        
                        addStoryLine(`üó∫Ô∏è <strong>–ù–æ–≤–∞—è –ª–æ–∫–∞—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞:</strong> ${location.emoji} ${location.name}`, 'quest-update');
                    }
                }
            });
        }

        // ========== –°–õ–£–ß–ê–ô–ù–´–ï –°–û–ë–´–¢–ò–Ø ==========
        function triggerRandomEvent() {
            if (Math.random() < 0.3) { // 30% —à–∞–Ω—Å
                const events = [
                    {
                        condition: () => Math.random() < 0.2,
                        action: () => {
                            const gold = Math.floor(Math.random() * 20) + 10;
                            gameState.player.gold += gold;
                            addStoryLine(`üí∞ <strong>–ù–∞—Ö–æ–¥–∫–∞!</strong> –í—ã –Ω–∞—à–ª–∏ ${gold} –∑–æ–ª–æ—Ç—ã—Ö –º–æ–Ω–µ—Ç!`, 'quest-update');
                        }
                    },
                    {
                        condition: () => Math.random() < 0.15 && gameState.player.hp < gameState.player.maxHp * 0.7,
                        action: () => {
                            const heal = Math.floor(Math.random() * 20) + 10;
                            gameState.player.hp = Math.min(gameState.player.maxHp, gameState.player.hp + heal);
                            addStoryLine(`‚ù§Ô∏è <strong>–ò—Å—Ü–µ–ª–µ–Ω–∏–µ!</strong> –í—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ –ø—Ä–∏–ª–∏–≤ —Å–∏–ª (+${heal} HP)`, 'quest-update');
                        }
                    },
                    {
                        condition: () => Math.random() < 0.1,
                        action: () => {
                            const items = [
                                { name: '–ú–∞–≥–∏—á–µ—Å–∫–∏–π –≥—Ä–∏–±', emoji: 'üçÑ', desc: '–û–±–ª–∞–¥–∞–µ—Ç —Å—Ç—Ä–∞–Ω–Ω—ã–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏' },
                                { name: '–°–∏—è—é—â–∏–π –∫–∞–º–µ–Ω—å', emoji: 'üíé', desc: '–°–≤–µ—Ç–∏—Ç—Å—è –≤ —Ç–µ–º–Ω–æ—Ç–µ' },
                                { name: '–î—Ä–µ–≤–Ω—è—è –º–æ–Ω–µ—Ç–∞', emoji: 'ü™ô', desc: '–ò–∑ –∑–∞–±—ã—Ç–æ–π —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏–∏' },
                                { name: '–¢–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–≤–∏—Ç–æ–∫', emoji: 'üìú', desc: '–ó–∞–ø–µ—á–∞—Ç–∞–Ω –º–∞–≥–∏–µ–π' }
                            ];
                            const item = items[Math.floor(Math.random() * items.length)];
                            gameState.inventory.push({
                                id: Date.now(),
                                name: item.name,
                                emoji: item.emoji,
                                description: item.desc
                            });
                            addStoryLine(`üéÅ <strong>–ù–∞—Ö–æ–¥–∫–∞!</strong> –í—ã –Ω–∞—à–ª–∏: ${item.emoji} ${item.name}`, 'quest-update');
                        }
                    },
                    {
                        condition: () => Math.random() < 0.05,
                        action: () => {
                            if (gameState.player.level < 10) {
                                gameState.player.level++;
                                gameState.player.attack += 2;
                                gameState.player.defense += 1;
                                gameState.player.maxHp += 10;
                                gameState.player.hp = gameState.player.maxHp;
                                gameState.player.maxMana += 5;
                                gameState.player.mana = gameState.player.maxMana;
                                
                                addStoryLine(`üåü <strong>–ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å!</strong> –¢–µ–ø–µ—Ä—å –≤—ã —É—Ä–æ–≤–Ω—è ${gameState.player.level}!<br>üó°Ô∏è +2 –∞—Ç–∞–∫–∏, üõ°Ô∏è +1 –∑–∞—â–∏—Ç—ã, ‚ù§Ô∏è +10 HP`, 'quest-update');
                                showNotification(`üéâ –£—Ä–æ–≤–µ–Ω—å ${gameState.player.level}!`, 3000);
                            }
                        }
                    }
                ];
                
                events.forEach(event => {
                    if (event.condition()) {
                        event.action();
                    }
                });
            }
        }

        // ========== –ò–ù–¢–ï–†–§–ï–ô–° ==========
        function updateUI() {
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ HP
            const hpPercent = (gameState.player.hp / gameState.player.maxHp) * 100;
            const hpFill = document.getElementById('player-hp-fill');
            const hpValue = document.getElementById('hp-value');
            
            if (hpFill) {
                hpFill.style.width = `${hpPercent}%`;
                hpFill.className = hpPercent < 30 ? 'hp-fill danger' : 'hp-fill';
                hpFill.querySelector('.hp-text').textContent = `${Math.round(hpPercent)}%`;
            }
            
            if (hpValue) {
                hpValue.textContent = `${gameState.player.hp}/${gameState.player.maxHp}`;
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–æ–≤
            document.getElementById('player-level').textContent = gameState.player.level;
            document.getElementById('player-attack').textContent = gameState.player.attack;
            document.getElementById('player-defense').textContent = gameState.player.defense;
            document.getElementById('player-exp').textContent = `${gameState.player.exp}/100`;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            updateInventory();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–≤–µ—Å—Ç–æ–≤
            updateQuests();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            document.getElementById('locations-count').textContent = gameState.discoveredLocations.length;
            document.getElementById('achievements-count').textContent = gameState.achievements.length;
            document.getElementById('gold-count').textContent = gameState.player.gold;
        }

        function updateInventory() {
            const container = document.getElementById('inventory-list');
            if (!container) return;
            
            container.innerHTML = gameState.inventory.map(item => `
                <div class="inventory-item" 
                     data-emoji="${item.emoji}"
                     title="${item.name}\n${item.description}">
                    ${item.name}
                </div>
            `).join('');
        }

        function updateQuests() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –≥–ª–∞–≤–Ω–æ–≥–æ –∫–≤–µ—Å—Ç–∞
            const progressElement = document.getElementById('quest-progress');
            if (progressElement) {
                progressElement.textContent = `–ü—Ä–æ–≥—Ä–µ—Å—Å: ${gameState.quests.main.progress}%`;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–ª–∏
            const objectivesContainer = document.getElementById('quest-objectives');
            if (objectivesContainer) {
                objectivesContainer.innerHTML = gameState.quests.main.objectives.map(obj => `
                    <div class="quest-item ${obj.done ? 'completed' : ''}">
                        <div class="quest-header">
                            <span class="quest-icon">${obj.done ? '‚úÖ' : '‚è≥'}</span>
                            <span class="quest-title">${obj.text}</span>
                        </div>
                    </div>
                `).join('');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–±–æ—á–Ω—ã–µ –∫–≤–µ—Å—Ç—ã
            const sideQuestsContainer = document.getElementById('side-quests');
            if (sideQuestsContainer) {
                const activeSideQuests = gameState.quests.side.filter(q => !q.done);
                if (activeSideQuests.length > 0) {
                    sideQuestsContainer.innerHTML = `
                        <div style="font-size: 14px; color: var(--secondary-color); margin-bottom: 10px;">
                            üåà –ü–æ–±–æ—á–Ω—ã–µ –∫–≤–µ—Å—Ç—ã:
                        </div>
                        ${activeSideQuests.map(quest => `
                            <div class="quest-item">
                                <div class="quest-header">
                                    <span class="quest-icon">üìã</span>
                                    <span class="quest-title">${quest.title}</span>
                                </div>
                                <div class="quest-description">${quest.description}</div>
                            </div>
                        `).join('')}
                    `;
                } else {
                    sideQuestsContainer.innerHTML = `
                        <div style="text-align: center; padding: 15px; color: var(--text-secondary); font-size: 14px;">
                            üéØ –í—Å–µ –ø–æ–±–æ—á–Ω—ã–µ –∫–≤–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã!
                        </div>
                    `;
                }
            }
        }

        function addStoryLine(text, className = 'ai-message') {
            const container = document.getElementById('story-text');
            if (!container) return;
            
            const line = document.createElement('div');
            line.className = `story-line ${className}`;
            line.innerHTML = text;
            
            container.appendChild(line);
            container.scrollTop = container.scrollHeight;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
            gameState.history.push({
                text: text,
                className: className,
                timestamp: new Date().toISOString()
            });
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é 50 —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
            if (gameState.history.length > 50) {
                gameState.history.shift();
            }
        }

        function showNotification(text, duration = 3000) {
            const notification = document.getElementById('notification');
            if (!notification) return;
            
            notification.textContent = text;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, duration);
        }

        function togglePanel(panelId) {
            const panel = document.getElementById(panelId);
            if (!panel) return;
            
            const isVisible = panel.style.display === 'block';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –ø–∞–Ω–µ–ª–∏
            document.querySelectorAll('.side-panel').forEach(p => {
                p.style.display = 'none';
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –ø–∞–Ω–µ–ª—å
            panel.style.display = isVisible ? 'none' : 'block';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ –ø–∞–Ω–µ–ª–∏
            const otherPanelId = panelId === 'inventory-panel' ? 'quest-panel' : 'inventory-panel';
            const otherPanel = document.getElementById(otherPanelId);
            if (otherPanel) {
                otherPanel.style.display = 'none';
            }
        }

        // ========== –°–û–•–†–ê–ù–ï–ù–ò–ï –ò–ì–†–´ ==========
        function saveGame() {
            try {
                const saveData = {
                    player: gameState.player,
                    inventory: gameState.inventory,
                    quests: gameState.quests,
                    discoveredLocations: gameState.discoveredLocations,
                    achievements: gameState.achievements,
                    history: gameState.history.slice(-20), // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å–æ–æ–±—â–µ–Ω–∏–π
                    timestamp: new Date().toISOString()
                };
                
                localStorage.setItem('dreamWeaverSave', JSON.stringify(saveData));
                console.log('–ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞');
            } catch (error) {
                console.warn('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
            }
        }

        function loadGame() {
            try {
                const saved = localStorage.getItem('dreamWeaverSave');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
                    Object.assign(gameState.player, parsed.player || {});
                    gameState.inventory = parsed.inventory || gameState.inventory;
                    gameState.quests = parsed.quests || gameState.quests;
                    gameState.discoveredLocations = parsed.discoveredLocations || gameState.discoveredLocations;
                    gameState.achievements = parsed.achievements || gameState.achievements;
                    gameState.history = parsed.history || gameState.history;
                    
                    console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ');
                    showNotification('üíæ –ü—Ä–æ–≥—Ä–µ—Å—Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω', 2000);
                    
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
                    const container = document.getElementById('story-text');
                    if (container && parsed.history) {
                        container.innerHTML = '';
                        parsed.history.forEach(item => {
                            const line = document.createElement('div');
                            line.className = `story-line ${item.className}`;
                            line.innerHTML = item.text;
                            container.appendChild(line);
                        });
                    }
                }
            } catch (error) {
                console.warn('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
            }
        }

        // ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ô –≠–ö–°–ü–û–†–¢ ==========
        window.AIDreamWeaver = {
            gameState,
            handleUserAction,
            showNotification,
            togglePanel,
            saveGame,
            loadGame
        };

        console.log('AI Dream Weaver –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!');
    </script>
</body>
</html>
